This page just explains how to build the software needed for OpenSPIM. For an overview of the source code, please have a look at [[Overview_of_the_source_code|this page]].

= QuickStart =

<span style='color:red;'>First, make sure you have your camera driver installed!</span>

If you have access to the OpenSPIM DropBox, just download & run the [https://dl-web.dropbox.com/get/Software&Drivers/Windows/32%20bit/OpenSPIM%20development%20environment/msysGit-netinstall-openspim.exe OpenSPIM development environment installer]. This will set up everything you need and perform the initial build.

If you do not have access to the DropBox, please follow the following instructions.

= Manual setup =

<span style='color:red;'>First, make sure you have your camera driver installed!</span>

== You need Git ==

First of all, you need to make sure that you have the version control software [http://git-scm.com Git] installed. If in doubt, just install [http://msysgit.github.com/ Git for Windows].

== Cloning the Micro-Manager and support sources ==

Wherever you like, e.g. in your home directory, call these commands:

# git clone git://fiji.sc/micromanager1.4 micromanager
# cd micromanager
# git checkout -t origin/openspim
# cd ..
# git clone git://fiji.sc/mmanager-3rdparty 3rdpartypublic
# cd 3rdpartypublic
# git checkout -t origin/openspim

== Building Micro-Manager ==

First, <u>make sure</u> that the environment variable ''JAVA_HOME'' is set and points to a valid JDK (you can add environment variables by right-clicking on the "Start" menu button, choosing "Open Windows Explorer", opening the context menu of "My Computer", selecting "Properties" and in the "Advanced mode" click on the "Environment variables" button. You need to restart the Visual Studio after adding the environment variable).

After installing [http://msdn.microsoft.com/en-us/express/future/bb421473 Visual Studio Express 2008], continue as described on the [http://valelab.ucsf.edu/~MM/MMwiki/index.php/Building_MM_on_Windows uManager Wiki].

=== Why Microsoft Visual C++? ===

There exists  a free and Open Source alternative to Microsoft Visual C++: [http://gcc.gnu.org/ GNU C++].

Unfortunately, it is impossible to build µManager on Windows with the GNU C++ compiler. The reason is that Microsoft Visual C++ uses an Application Binary Interface (''ABI'') which predates, and is incompatible with, the standard defined by the C++ consortium, but GNU C++ abides by the standard. All of the shared libraries provided by vendors were compiled for Microsoft Visual C++, though, so linking using GNU C++ is impossible.

= µManager scripting/plugins =

One of the coolest things in µManager is the Beanshell Scripting support. You can launch it through the ''Tools>Script Panel'' menu item. Those Beanshell scripts can interact with the GUI of µManager through the global ''gui'' variable which is actually an instance of ''org.micromanager.MMStudioMainFrame'', and with the MMCore through the global ''mmc'' variable which is an instance of ''mmcorej.CMMCore'' (the binding to the C++ core).

When prototyping, it is best to start out with Beanshell scripts and once things get polished enough, turn them into µManager plugins. Such plugins are connected to the µManager application through the method ''setApp()'' which must be implemented when implementing the ''org.micromanager.api.MMPlugin'' interface. This method is passed an instance of ''org.micromanager.api.ScriptInterface'' which has a method ''getMMCore()''. Unfortunately, it has no method to retrieve a reference to the ''MMStudioMainFrame'', but you can use the static method ''getInstance()'' of said class to retrieve the singleton.

To provide ease of transition between scripting and plugin coding, we do the following in the OpenSPIM plugin: we have two fields, unsurprisingly called ''mmc'' and ''gui'', which are initialized in the ''setApp()'' method.

= Debugging =

== Look at the CoreLog ==

Whatever you do, first have a look at the file CoreLog<date>.txt, located in the directory Micro-Manager was started from (this is not necessarily the directory where it is installed, beware!).

== When Micro-Manager does not list the driver ==

# Make sure the .dll is present in ''dist/mm/Win32/''
# Use the [http://www.dependencywalker.com/ Dependency Walker] to detect missing dependencies

== Micro-Manager just crashes when I connect <device> ==

Micro-Manager's memory management is not very safe on the driver side. Try to start Fiji with less memory reserved for Java, e.g. ''--mem=512m''.

If that does not help, try to find out what's in [[#Look at the CoreLog]], and if that fails, too, you might have more luck [[#Using Visual Studio's interactive debugger]].

== Using Visual Studio's interactive debugger ==

Start Fiji, and before starting Micro-Manager use Visual Studio's ''Debug>Attach to Process...'' to attach to the process. After that, you may set breakpoints (optional) and then start Micro-Manager in Fiji.

== Using Eclipse to debug MicroManager/SPIM Acquisition ==

# Make sure you have Eclipse installed.
# Add Fiji's JRE to Eclipse: 
## Window -> Preferences; under Java, select Installed JREs and click Add...
### Use Standard VM.
### Set the JRE Home to fiji/java/<your OS>/jdk1.6.0_24 (or similar). Eclipse should fill in the rest.
### Click Finish.
## Check the checkbox next to the newly-added JRE.
# Create a new project for Micro-Manager Studio:
## File -> New -> Java Project...
### Uncheck "Use Default Location"
### Point Location to fiji/3rdparty/micromanager/mmstudio
### Eclipse should auto-configure all sorts of useful things.
## Click Next.
### On the Libraries tab, click Add External JARs...
#### From fiji/3rdparty/micromanager/dist/jars:
####* bsh.jar
####* commons-math-2.0.jar
####* ij.jar
####* MMCoreJ.jar
####* MMAcqEngine.jar
####* swing-layout-1.0.4.jar
####* swingx-0.9.5.jar
## Click Finish.
# Create a project for SPIMAcquisition:
## File -> New -> Java Project...
### Uncheck "Use Default Location"
### Point Location to fiji/3rdparty/micromanager/plugins/SPIMAcquisition
### Let Eclipse auto-configure things.
## Click Next.
### On the Projects tab, click Add... and select the mmstudio project added above.
### On the Libraries tab, click Add External JARs...
#### From fiji/3rdparty/micromanager/dist/jars:
####* ij.jar
####* MMCoreJ.jar
## Click Finish.
# Depending on your workspace settings, you may need to reduce the enforced JRE level for both projects:
## Right click on each project and go to Properties.
## Select Java Compiler.
## Enable project-specific settings and set the Compiler Compliance Level to 1.6 (depending on the JDK used by FIJI).
## Click Apply then OK.
# Set up the debug configuration:
## Run -> Debug Configurations...
### Create a fresh launch configuration
### Use SPIMAcquisition as the project.
### For the Main class, click Search... and find ij.ImageJ
### On the Arguments tab, under VM arguments, pass the following: <code>-Dplugin.dir=fiji/3rdparty/micromanager/dist</code> (modifying as appropriate).
### On the Classpath tab, select SPIMAcquisition, then Add External JARs...
#### From fiji/3rdparty/micromanager/dist/jars:
####* MMAcqEngine.jar
### Click Apply.
## Click Debug to make sure everything works.

= Further reading =

[[A birds-eye view of the OpenSPIM source code]]

[[Category:Software]]

= Timelapse Registration =

Timelapse registration is necessary because the imaged specimen may, and in most cases will, drift over a long acquistion period. In OpenSPIM this situation is typically exaggregated because 

a) we set-up the imaging angles quickly and approximately, relying on later re-adjustment based on imaging result (thus the first time-points are usually quite off with respect to the rest of the time lapse - see [[Raw_data|sample raw data]]), 

b) the motors precision is limited.

The pre-requisite for time-series registration is to perform [[Registration#Cross-road_in_SPIM_plugins|'''all individual time-point registrations''']], particularly the segmentation of the beads. 

''Note that it is possible to do time-series registration also directly, i.e. segment the beads and do time-series registration in one step, however this is not a typical workflow.''

As before we walk through the set-up of plugin input, annotate the output and look into the new registration files created.

== Input ==

{|
|-
|We start by going back to registration plugin, '''Plugins->SPIM registration->Bead-based registration''', and keep the same parameters as before in the first dialog ('''Single channel''' and '''Difference-of-Mean''').
|[[File:Spim plugin menu.jpg|thumb|200px|right|Screenshot of SPIM registration section of Fiji plugin menu]]
|[[File:Registration screen1.jpg|thumb|200px|right|Screenshot of the first dialog of the bead based registration plugin]]
|-
|The main dialog is the same as the one we used in indvidual time-point registration. The top set of parameters specifying file location and format should be pre-filled. We need to only change the '''Timpoints to process''' to '''0-10'''.


Next we click the checkbox '''Load segmented beads''' which signifies that the plugin should simply look into the [[Registration#Cross-road_in_SPIM_plugins|previously established]] ''[[Registration#Output|.beads.txt]]'' files in the ''/registration'' subfolder and load them. This will happen very fast compared to re-segmenting the beads. All parameters for bead segmentation are ignored.


We need to specify the calibration as explained [[Registration#Input|before]].


We will use the '''affine''' transformation model.


The option '''Re-use per timepoint registration''' should be clicked. I am actually not sure what it does, but I assume that it will load the transformation models determined in the per time-point registration and use them as a starting point. 


Finally, we must decide how will the reference time-point be determined. Reference time-point is the time-point to which all others will be registered, see [http://fiji.sc/wiki/index.php/SPIM_Bead_Registration#How_timelapse_registration_works for detailed explanation]. We have three option for how to choose it:


* Manually (interactive) - for this option we will be presented with a graph summarizing the registration error for each individual time-point and we will be able to choose one by clicking on the graph (see below)
* Manually (specify) - here we simply enter the index of s reference time-point, for example in the middle of the time-series
* Automatically - the plugin will settle on a reference time-point automatically, choosing the one with the lowest registration error (average bead displacement)


We choose '''Manually (interactive)''' and continue by pressing '''OK'''.
 



| colspan= "2"|[[File:TLreg1.png|thumb|400px|right|Main window of bead-based registration set-up for timelapse]]
|-
|Text
| colspan= "2"|[[File:TLreg2.png|thumb|400px|right|Selection of reference time point. Click with mouse pointer on tp 6 which has lowest error]]
|}

== Run ==

== Output ==

= Fusion of timelapse data =
